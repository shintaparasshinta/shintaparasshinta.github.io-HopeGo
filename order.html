<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HopeGo</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="navbar.css" />
    <link rel="stylesheet" href="order.css">
  </head>
  <body>
    <!-- navbar -->
    <nav class="navbar navbar-expand-lg sticky-top">
      <div class="container">
        <a class="navbar-brand" href="index.html">
          <img
            src="bahan/HopeGo.png"
            alt="HopeGo Logo"
            width="224"
            height="48"
          />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div
          class="collapse navbar-collapse justify-content-end"
          id="navbarNav"
        >
          <ul class="navbar-nav text-center">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="service.html">Service</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="order.html">Order</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="lacak.html">Lacak Paket</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="information.html">Information</a>
            </li>
            <li class="nav-item">
              <a class="nav-link fw-bold" href="login.html">Login / Register</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container my-5">
      <h2 class="text-center text-warning fw-bold mb-4">
        Form Pemesanan Pengiriman
      </h2>
      <form id="orderForm" class="form-section">
        <!-- Pengirim -->
        <h5 class="text-warning fw-bold mb-3">Data Pengirim</h5>
        <div class="mb-3">
          <label>Nama Pengirim</label>
          <input type="text" class="form-control" required />
        </div>
        <div class="mb-3">
          <label>No HP Pengirim</label>
          <input type="tel" class="form-control" id="hpPengirim" required />
          <div id="hpPengirimWarning" class="form-text d-none text-danger">
            Masukkan nomor HP yang valid (10-13 digit).
          </div>
        </div>
        <div class="mb-3">
          <label>Email Pengirim</label>
          <input
            type="email"
            class="form-control"
            id="emailPengirim"
            maxlength="20"
            required
          />
          <div class="form-text text-danger d-none" id="emailWarning">
            Masukkan email yang valid (maksimal 20 karakter).
          </div>
        </div>
        <div class="mb-3">
          <label>Kota/ Pengirim</label>
          <select class="form-select" id="asal" required></select>
        </div>

        <!-- Penerima -->
        <h5 class="text-warning fw-bold mt-4 mb-3">Data Penerima</h5>
        <div class="mb-3">
          <label>Nama Penerima</label>
          <input type="text" class="form-control" required />
        </div>
        <!-- <div class="mb-3">
          <label>No HP Penerima</label>
          <input type="tel" class="form-control" required />
        </div> -->
        <div class="mb-3">
          <label>No HP Penerima</label>
          <input type="tel" class="form-control" id="hpPenerima" required />
          <div id="hpPenerimaWarning" class="form-text d-none text-danger">
            Masukkan nomor HP yang valid (10-13 digit).
          </div>
        </div>
        <div class="mb-3">
          <label>Kota/ Tujuan</label>
          <select class="form-select" id="tujuan" required></select>
        </div>

        <!-- Detail Paket -->
        <h5 class="text-warning fw-bold mt-4 mb-3">Detail Paket</h5>
        <div class="mb-3">
          <label>Berat Barang (kg)</label>
          <input
            type="number"
            class="form-control"
            id="beratBarang"
            step="0.1"
            min="0.1"
            max="30"
            required
          />
        </div>
        <div class="mb-3">
          <label>Jenis Layanan</label>
          <select class="form-select" id="layanan" required>
            <option disabled selected>Pilih layanan</option>
            <option value="Reguler">Reguler</option>
            <option value="Kilat">Kilat</option>
            <option value="Same Day">Same Day</option>
            <option value="COD">COD</option>
            <option value="Ekspedisi Besar">Ekspedisi Besar</option>
          </select>
        </div>

        <div class="mb-3">
          <label>Catatan Tambahan (Opsional)</label>
          <textarea
            class="form-control"
            id="catatan"
            rows="3"
            maxlength="500"
            placeholder="Maksimal 500 karakter"
          ></textarea>
          <div class="form-text text-danger d-none" id="catatanWarning">
            Maksimal 500 karakter.
          </div>
        </div>

        <!-- Tambahan Layanan -->
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" id="asuransi" />
          <label class="form-check-label" for="asuransi">
            Tambah Asuransi (+Rp 5.000)</label
          >
        </div>
        <div class="form-check mb-3">
          <input class="form-check-input" type="checkbox" id="jemput" />
          <label class="form-check-label" for="jemput">
            Layanan Jemput (+Rp 10.000)</label
          >
        </div>

        <!-- Tarif dan Total -->
        <div class="mb-3">
          <label>Tarif Layanan</label>
          <input type="text" class="form-control" id="tarif" readonly />
        </div>
        <div class="mb-3">
          <label>Total Biaya Pengiriman</label>
          <input type="text" class="form-control" id="total" readonly />
        </div>

        <div class="text-center">
          <button type="submit" class="btn btn-warning px-5 fw-bold">
            Pesan Sekarang
          </button>
        </div>
      </form>
    </div>

    <script>
      const kotaList = [
        "Jakarta",
        "Surabaya",
        "Bandung",
        "Medan",
        "Bekasi",
        "Depok",
        "Semarang",
        "Palembang",
        "Tangerang",
        "Makassar",
        "Bogor",
        "Gresik",
        "Sleman",
        "Karawang",
        "Malang",
        "Sidoarjo",
        "Banyumas",
        "Badung",
        "Cianjur",
      ];

      const jarakDummy = {
        "Makassar-Jakarta": 1399.24,
        "Karawang-Surabaya": 611.77,
        "Bandung-Sleman": 314.8,
        "Medan-Banyumas": 1703.34,
        "Bekasi-Sidoarjo": 646.76,
        "Depok-Cianjur": 60.31,
        "Semarang-Surabaya": 261.72,
        "Sidoarjo-Palembang": 1009.65,
        "Sleman-Tangerang": 445.25,
        "Makassar-Bogor": 1406.16,
        "Gresik-Bogor": 647.8,
        "Gresik-Makassar": 783.18,
        "Sleman-Karawang": 370.31,
        "Badung-Karawang": 904.15,
        "Sleman-Malang": 252.18,
        "Bogor-Sidoarjo": 658.83,
        "Bandung Banyumas": 196.43,
        "Badung-Depok": 956.75,
        "Sleman-Cianjur": 368.34,
        "Bandung-Sidoarjo": 566.24,
      };

      const tarifLayanan = {
        Reguler: 18000,
        Kilat: 35000,
        "Same Day": 45000,
        COD: 20000,
        "Ekspedisi Besar": 150000,
      };

      // Isi kota
      function isiDropdown() {
        kotaList.forEach((kota) => {
          const opt1 = new Option(kota, kota);
          const opt2 = new Option(kota, kota);
          document.getElementById("asal").appendChild(opt1);
          document.getElementById("tujuan").appendChild(opt2.cloneNode(true));
        });
      }
      isiDropdown();

      // Validasi no hp
      function validasiNomorHP(idInput, idPeringatan) {
        const input = document.getElementById(idInput);
        const peringatan = document.getElementById(idPeringatan);
        input.addEventListener("input", function () {
          const pola = /^(08|628)\d{10,13}$/;
          const valid = pola.test(input.value);
          if (!valid) {
            peringatan.classList.remove("d-none");
          } else {
            peringatan.classList.add("d-none");
          }
        });
      }
      // menjalankan validasi
      validasiNomorHP("hpPengirim", "hpPengirimWarning");
      validasiNomorHP("hpPenerima", "hpPenerimaWarning");

      const emailInput = document.getElementById("emailPengirim");
      const emailWarning = document.getElementById("emailWarning");

      emailInput.addEventListener("input", () => {
        const email = emailInput.value;
        const polaEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const terlaluPanjang = email.length > 20;
        const tidakValid = !polaEmail.test(email);

        if (terlaluPanjang || tidakValid) {
          emailWarning.classList.remove("d-none");
        } else {
          emailWarning.classList.add("d-none");
        }
      });

      const beratInput = document.getElementById("beratBarang");
      beratInput.addEventListener("input", () => {
        const berat = parseFloat(beratInput.value);
        if (berat > 30) {
          alert("Berat maksimal adalah 30kg.");
          beratInput.value = 30;
        }
        if (berat > 10) {
          document.getElementById("layanan").value = "Ekspedisi Besar";
        }
        updateTarif();
        updateTotal();
      });

      const layananSelect = document.getElementById("layanan");
      layananSelect.addEventListener("change", () => {
        updateTarif();
        updateTotal();
      });

      function updateTarif() {
        const jenis = layananSelect.value;
        document.getElementById("tarif").value =
          tarifLayanan[jenis]?.toLocaleString("id-ID") || "";
      }

      function updateTotal() {
        const asal = document.getElementById("asal").value;
        const tujuan = document.getElementById("tujuan").value;
        const key = `${asal}-${tujuan}`;
        const key2 = `${tujuan}-${asal}`;
        const jarak = jarakDummy[key] || jarakDummy[key2] || 100; //fallback/default: 100 km
        const biayaJarak = Math.ceil(jarak / 50) * 10000;
        const tarif = tarifLayanan[layananSelect.value] || 0;
        const asuransi = document.getElementById("asuransi").checked ? 5000 : 0;
        const jemput = document.getElementById("jemput").checked ? 10000 : 0;

        const total = tarif + biayaJarak + asuransi + jemput;
        document.getElementById("total").value = total.toLocaleString("id-ID");
      }

      document.getElementById("tujuan").addEventListener("change", updateTotal);
      document.getElementById("asal").addEventListener("change", updateTotal);
      document
        .getElementById("asuransi")
        .addEventListener("change", updateTotal);
      document.getElementById("jemput").addEventListener("change", updateTotal);

      function generateResi() {
        return "HPG" + Math.floor(10000000 + Math.random() * 90000000); // untuk menghasilkan angka acak, 'HPG' tetap
      }

      document
        .getElementById("orderForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const hpPengirim = document.getElementById("hpPengirim").value;
          const hpPenerima = document.getElementById("hpPenerima").value;
          // Validasi HP
          if (
            !/^\d{10,13}$/.test(hpPengirim) ||
            !/^\d{10,13}$/.test(hpPenerima)
          ) {
            alert("Pastikan nomor HP valid (10-13 digit).");
            return;
          }
          const resi = generateResi();
          alert("Pesanan berhasil!\nNomor Resi Anda: " + resi);
          this.reset();
          document.getElementById("tarif").value = "";
          document.getElementById("total").value = "";
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
